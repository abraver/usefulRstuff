{
  "hash": "b0ad90e7d3569d9094478069f24e2ec2",
  "result": {
    "markdown": "---\ntitle: \"Spotlight subsets of data in your plots with `gghighlight`\"\n\ndate: \"7/6/23\"\n\ncategories:\n  - visualization\n\ntoc: true\n---\n<script src=\"/jquery-3.7.0.min.js\"></script>\n<script src=\"/fold.js\"></script>\n<script src=\"/move_session_info.js\"></script>\n\n\n\n\n\n\n\n\n\n\n\n<!-- begin content -->\n\n\n\n\n\n::: {.cell hash='index_cache/html/setup_b776bcb1cc19d5561a7dbf474281a81b'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Setup\"}\nlibrary(tidyverse)\n```\n:::\n\n## The problem\n\nWe often want to make a subset of data stand out from the rest, but doing so manually is a bit tedious. You could, for example, add a logical column to the data `highlight`, and set a plot aesthetic to make `1`s in a bright color and `0`s in grey.\n\nBut `gghighlight` automates this process for `ggplot2` plots. Let's look at the life expectancy dataset from `gapminder`. Even when color-coding by continent, it's very difficult to pick out individual countries. We can use `gghighlight`, though, to emphasize countries with the top 10 highest populations:\n\n\n::: {.cell .column-page layout-ncol=\"2\" hash='index_cache/html/unnamed-chunk-3_a0730677d1678b178cb7701e129a8cf6'}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(gghighlight)\n\nbase_plot <- gapminder::gapminder |> \n  ggplot(aes(x = year, y = lifeExp, color = continent)) +\n  geom_line(aes(group = country))\n\npretty_plot <- base_plot +\n  scale_x_continuous(expand = expansion(mult = c(0,0.25))) +\n  geom_line(aes(group = country)) +\n  gghighlight(max(pop), max_highlight = 10,\n              unhighlighted_params = list(alpha = 0.25,\n                                          color = NULL\n              ),\n              line_label_type = \"ggrepel_text\",\n              label_params = list(\n                                  hjust = 0,\n                                  direction = \"y\",\n                                  nudge_x = 10,\n                                  segment.size = 0.2\n              ))\n\nbase_plot\n```\n\n::: {.cell-output-display}\n![Vanilla `ggplot`: Too busy to glean any insights](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\npretty_plot\n```\n\n::: {.cell-output-display}\n![Countries with the top 10 highest populations `gghighlight`ed](index_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n\n## `gghighlight` basics\n\nLet's start with the busy plot from above, which we've saved as `base_plot`.  The `gghighlight()` function can be added to any `ggplot`, and requires only a predicate to select the highlighted portion of the data (passed directly to `dplyr::filter()`, so anything you can do there is fair game).  Here we highlight countries with a population greater than 50 million.^[NB: unless you set `use_direct_label = FALSE`, the legend will not be included in a highlighted plot.  Also, if you want the colors to match an unhighlighted version of the plot, use `keep_scales = TRUE`.]\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-4_08a96b3ae8b26f5de706f9c690413a0d'}\n\n```{.r .cell-code}\nbase_plot +\n  gghighlight(pop > 50000000)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\nSince there are so many un-highlighted lines, it's quite hard to see what's happening.  We can change the aesthetics of the un-highlighted lines with `unhighlighted_params`.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-5_b1a00fe3977290a5d6c0c9160ae01fc6'}\n\n```{.r .cell-code}\nbase_plot +\n  gghighlight(pop > 50000000,\n              unhighlighted_params = list(alpha = 0.25))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## More complicated filtering criteria\n\nSince the first argument(s) of `gghighlight` get passed directly to `filter`, you can include multiple filtering criteria, like population over 50 million and only countries in Asia:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-6_957071608e2dbce79f385080bfe53a22'}\n\n```{.r .cell-code}\nbase_plot +\n  gghighlight(pop > 50000000, continent == \"Asia\",\n              unhighlighted_params = list(alpha = 0.25))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n(Note that in this plot, where we have relatively few highlighted lines, `gghighlight` adds labels for us.)\n\nWe can also provide a non-logical predicate to filter by, for example the top ten countries by population.  The predicate is used to order the results, and the `max_highlight` argument determines the top `n` rows/groups based on that criterion:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-7_cf2b0fae5b299ffb4b9cb0c8a2de0ef7'}\n\n```{.r .cell-code}\nbase_plot +\n  gghighlight(max(pop), max_highlight = 10,\n              unhighlighted_params = list(alpha = 0.25))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n## Labels\n\nThe labels in the previous plot make things pretty crowded.  `gghighlight` uses the `ggrepel::geom_label_repel` geom by default, and arguments can be passed to that function with the `label_params` argument.^[See the `geom_label_repel` documentation for more options.] Here we'll modify `max.overlaps`, which removes some labels when there are too many overlapping objects:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-8_a13e9829a3f1e882b2f0e1266e7aea0b'}\n\n```{.r .cell-code}\nbase_plot +\n  gghighlight(max(pop), max_highlight = 10,\n              unhighlighted_params = list(alpha = 0.25),\n              label_params = list(\n                max.overlaps = 5\n              ))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\nWhat if we want to have all of the labels off on one side, rather than on top of the plotted data?  We can once again avail ourselves of `label_params`.  I also prefer the labels to be text only---no border---which is accomplished with `line_label_type = \"ggrepel_text\"`.\n \n\n::: {.cell hash='index_cache/html/unnamed-chunk-9_81b5c908b492899d9a08e0033229ac98'}\n\n```{.r .cell-code}\nbase_plot +\n  gghighlight(max(pop), max_highlight = 10,\n    unhighlighted_params = list(alpha = 0.25),\n    line_label_type = \"ggrepel_text\",\n    label_params = list(\n      hjust = 0, # align label text\n      direction = \"y\", # allow shifting labels on y axis to make room\n      nudge_x = 10, # push everything further to the right\n      segment.size = 0.2 # make pointing lines thinner\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\nOne final tweak is to expand the plot rightward, so there is more room for labels.  This is done by modifying the scale of the plot, as below.  (I have not found a good way to make the labels appear in the margin)\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-10_2a24bb76d1603b1b5a04be40c41f1e6e'}\n\n```{.r .cell-code}\nbase_plot +\n # Modify scale:\n  scale_x_continuous(expand = expansion(mult = c(0,0.25))) +\n  gghighlight(max(pop), max_highlight = 10,\n    unhighlighted_params = list(alpha = 0.25),\n    line_label_type = \"ggrepel_text\",\n    label_params = list(\n      hjust = 0, # align label text\n      direction = \"y\", # allow shifting labels on y axis to make room\n      nudge_x = 10, # push everything further to the right\n      segment.size = 0.2 # make pointing lines thinner\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nYou'll notice that in the plot above, the labels are drawn _inside_ the plotting area, and not in the margin.  I have not found a good way to make the labels in the margin only.  The closest built-in option to `gghighlight` is to set `line_label_type = \"sec_axis\"` instead of `\"ggrepel_text\"`, but this does not prevent the labels from overlapping each other (since it's not using `ggrepel` anymore).  This is ok in a plot with only a few---or very spaced out---labels, but doesn't work well for our current plot.  You can see in the second plot below that it looks pretty good when we select, say, only the top 3 countries by population.\n\n\n::: {.cell .column-page layout-ncol=\"2\" hash='index_cache/html/unnamed-chunk-11_49abe6911bbe5df09f4d867342e2f8dd'}\n\n```{.r .cell-code}\nbase_plot +\n  gghighlight(max(pop), max_highlight = 10,\n    unhighlighted_params = list(alpha = 0.25),\n    line_label_type = \"sec_axis\"\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nbase_plot +\n  gghighlight(max(pop), max_highlight = 3, # ***\n    unhighlighted_params = list(alpha = 0.25),\n    line_label_type = \"sec_axis\"\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n\n\n## Other geoms\n\n`gghighlight` works on geoms other than `line`, and in fact looks pretty snazzy in barplots/histograms plotted by group, where there is a lot of overlap.  In the highlighted plot we facet by continent, but also show the overall distribution in gray.\n\n::: {.panel-tabset}\n#### Highlighting\n\n::: {.cell hash='index_cache/html/unnamed-chunk-12_64ec42da78caa350d321c7f8a099bbfb'}\n\n```{.r .cell-code}\ngapminder::gapminder |> \n  ggplot(aes(x = lifeExp, fill = continent)) +\n  geom_histogram() +\n  facet_wrap(~continent) +\n  gghighlight()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n#### No highlighting\n\n::: {.cell hash='index_cache/html/unnamed-chunk-13_8241e140e38d439b729ee30bdc005eb9'}\n\n```{.r .cell-code}\ngapminder::gapminder |> \n  ggplot(aes(x = lifeExp, fill = continent)) +\n  geom_histogram()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n:::\n\nAnd with `geom_point`, for example, we can call out the top ten countries by population in the data from 2002:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-14_fc195a459c4c153b6cbca730b59c58ca'}\n\n```{.r .cell-code}\ngapminder::gapminder |> \n  filter(year == 2002) |> \n  ggplot(aes(x = lifeExp, y = pop, color = country)) +\n  geom_point(group = 1) +\n  gghighlight(max(pop), max_highlight = 10,\n              label_key = country,\n              label_params = list(\n                max.overlaps = 1\n              ))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: ggrepel: 6 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\nNote above that we're warned that there were \"too many overlaps,\" and therefore some labels are omitted.   In fact, if there are too many overlapping data points, all labels will be omitted  You can remedy this by either having fewer highlighted points and/or changing `max.overlaps`.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-15_5d277e96fcbd976004e6cd3af4b53a07'}\n\n```{.r .cell-code}\ngapminder::gapminder |> \n  filter(year == 2002) |> \n  ggplot(aes(x = lifeExp, y = pop, color = country)) +\n  geom_point(group = 1) +\n  gghighlight(max(pop), max_highlight = 5,\n              label_key = country,\n              label_params = list(\n                max.overlaps = 50\n              ))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n<!-- End content -->\n\n\n\n<div id = \"footer-session-info\">\n<details>\n<summary>Session info and package versions</summary>\n::: {.cell hash='index_cache/html/unnamed-chunk-17_e4c39ad0395e7aa68e02447d84d00b77'}\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n setting  value\n version  R version 4.3.1 (2023-06-16)\n os       macOS Ventura 13.4.1\n system   aarch64, darwin20\n ui       X11\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       America/Chicago\n date     2023-07-08\n pandoc   3.1.1 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/ (via rmarkdown)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n─ Packages ───────────────────────────────────────────────────────────────────\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n           package loadedversion       date         source\n          asbutils    0.0.0.9001 2023-07-06          local\n               cli         3.6.1 2023-03-23 CRAN (R 4.3.0)\n         codetools        0.2-19 2023-02-01 CRAN (R 4.3.1)\n        colorspace         2.1-0 2023-01-23 CRAN (R 4.3.0)\n            crayon         1.5.2 2022-09-29 CRAN (R 4.3.0)\n              crul         1.4.0 2023-05-17 CRAN (R 4.3.0)\n              curl         5.0.1 2023-06-07 CRAN (R 4.3.0)\n            digest        0.6.31 2022-12-11 CRAN (R 4.3.0)\n             dplyr         1.1.2 2023-04-20 CRAN (R 4.3.0)\n          ellipsis         0.3.2 2021-04-29 CRAN (R 4.3.0)\n          evaluate          0.21 2023-05-05 CRAN (R 4.3.0)\n         extrafont          0.19 2023-01-18 CRAN (R 4.3.0)\n       extrafontdb           1.0 2012-06-11 CRAN (R 4.3.0)\n             fansi         1.0.4 2023-01-22 CRAN (R 4.3.0)\n            farver         2.1.1 2022-07-06 CRAN (R 4.3.0)\n           fastmap         1.1.1 2023-02-24 CRAN (R 4.3.0)\n fontBitstreamVera         0.1.1 2017-02-01 CRAN (R 4.3.0)\n    fontLiberation         0.1.0 2016-10-15 CRAN (R 4.3.0)\n        fontquiver         0.2.1 2017-02-01 CRAN (R 4.3.0)\n           forcats         1.0.0 2023-01-29 CRAN (R 4.3.0)\n         gapminder         1.0.0 2023-03-10 CRAN (R 4.3.0)\n           gdtools         0.3.3 2023-03-27 CRAN (R 4.3.0)\n          generics         0.1.3 2022-07-05 CRAN (R 4.3.0)\n            gfonts         0.2.0 2023-01-08 CRAN (R 4.3.0)\n       gghighlight         0.4.0 2022-10-16 CRAN (R 4.3.0)\n           ggplot2         3.4.2 2023-04-03 CRAN (R 4.3.0)\n           ggrepel         0.9.3 2023-02-03 CRAN (R 4.3.0)\n              glue         1.6.2 2022-02-24 CRAN (R 4.3.0)\n            gtable         0.3.3 2023-03-21 CRAN (R 4.3.0)\n               hms         1.1.3 2023-03-21 CRAN (R 4.3.0)\n        hrbrthemes         0.8.0 2020-03-06 CRAN (R 4.3.0)\n         htmltools         0.5.5 2023-03-23 CRAN (R 4.3.0)\n       htmlwidgets         1.6.2 2023-03-17 CRAN (R 4.3.0)\n          httpcode         0.3.0 2020-04-10 CRAN (R 4.3.0)\n            httpuv        1.6.11 2023-05-11 CRAN (R 4.3.0)\n          jsonlite         1.8.4 2023-06-29 CRAN (R 4.3.0)\n             knitr          1.43 2023-05-25 CRAN (R 4.3.0)\n          labeling         0.4.2 2020-10-20 CRAN (R 4.3.0)\n             later         1.3.1 2023-05-02 CRAN (R 4.3.0)\n         lifecycle         1.0.3 2022-10-07 CRAN (R 4.3.0)\n         lubridate         1.9.2 2023-02-10 CRAN (R 4.3.0)\n          magrittr         2.0.3 2022-03-30 CRAN (R 4.3.0)\n              mime          0.12 2021-09-28 CRAN (R 4.3.0)\n           munsell         0.5.0 2018-06-12 CRAN (R 4.3.0)\n            pillar         1.9.0 2023-03-22 CRAN (R 4.3.0)\n         pkgconfig         2.0.3 2019-09-22 CRAN (R 4.3.0)\n          promises       1.2.0.1 2021-02-11 CRAN (R 4.3.0)\n             purrr         1.0.1 2023-01-10 CRAN (R 4.3.0)\n                R6         2.5.1 2021-08-19 CRAN (R 4.3.0)\n              ragg         1.2.5 2023-01-12 CRAN (R 4.3.0)\n              Rcpp        1.0.10 2023-01-22 CRAN (R 4.3.0)\n             readr         2.1.4 2023-02-10 CRAN (R 4.3.0)\n              renv        0.17.3 2023-04-06 CRAN (R 4.3.0)\n             rlang         1.1.1 2023-04-28 CRAN (R 4.3.0)\n         rmarkdown          2.21 2023-06-01 CRAN (R 4.3.0)\n        rstudioapi          0.14 2022-08-22 CRAN (R 4.3.0)\n          Rttf2pt1        1.3.12 2023-01-22 CRAN (R 4.3.0)\n            scales         1.2.1 2022-08-20 CRAN (R 4.3.0)\n       sessioninfo         1.2.2 2021-12-06 CRAN (R 4.3.0)\n             shiny         1.7.4 2022-12-15 CRAN (R 4.3.0)\n           stringi        1.7.12 2023-01-11 CRAN (R 4.3.0)\n           stringr         1.5.0 2022-12-02 CRAN (R 4.3.0)\n       systemfonts         1.0.4 2022-02-11 CRAN (R 4.3.0)\n       textshaping         0.3.6 2021-10-13 CRAN (R 4.3.0)\n            tibble         3.2.1 2023-03-20 CRAN (R 4.3.0)\n             tidyr         1.3.0 2023-01-24 CRAN (R 4.3.0)\n        tidyselect         1.2.0 2022-10-10 CRAN (R 4.3.0)\n         tidyverse         2.0.0 2023-02-22 CRAN (R 4.3.0)\n        timechange         0.2.0 2023-01-11 CRAN (R 4.3.0)\n              tzdb         0.3.0 2023-05-12 CRAN (R 4.3.0)\n              utf8         1.2.3 2023-01-31 CRAN (R 4.3.0)\n             vctrs         0.6.2 2023-06-14 CRAN (R 4.3.0)\n             withr         2.5.0 2022-03-03 CRAN (R 4.3.0)\n              xfun          0.39 2023-04-20 CRAN (R 4.3.0)\n            xtable         1.8-4 2019-04-21 CRAN (R 4.3.0)\n              yaml         2.3.7 2023-01-23 CRAN (R 4.3.0)\n```\n:::\n:::\n</details>\n</div>\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/roboto-condensed-0.3.3/css/roboto-condensed.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}